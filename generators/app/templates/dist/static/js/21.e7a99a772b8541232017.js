webpackJsonp([21],{C49v:function(t,e){},EMNk:function(t,e){},JbDN:function(t,e){},MQPH:function(t,e){},"tIi/":function(t,e){},tyGG:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("woOf"),n=a.n(r),i=a("QmSG"),o={props:{},data:function(){return{name:"",status:"",span:8,formSize:i.a.homeFormSize,btnSize:i.a.homeBtn,date:"",options:[{value:"",label:"请选择"},{value:"0",label:"禁用"},{value:"1",label:"启用"}],pickerOptions:{disabledDate:function(t){return t.getTime()>Date.now()}}}},computed:{beginDate:function(){return Array.isArray(this.date)?this.date[0]:""},endDate:function(){return Array.isArray(this.date)?this.date[1]:""}},watch:{name:function(t){this.changeText(t)}},methods:{searchCheck:function(t){if("string"!=typeof t)return!0;if(!t.length)return!0;return!!/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(t)||(this.$toast("输入不正确（须中文、英文、数字输入），请重新输入"),!1)},changeText:function(t){if("string"!=typeof t)return!0;if(!t.length)return!0;for(var e=t.split("'"),a=!0,r=0;r<e.length;r++)a=!!e[r].length;return!(!/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(t)&&!a)||(this.$toast("输入不正确（须中文、英文、数字输入），请重新输入"),!1)},handlerSearch:function(){if(this.searchCheck(this.name)){var t=this.name.replace(/%/,""),e={name:t,keyword:t,beginDate:this.beginDate,endDate:this.endDate};this.$emit("search",e)}}},components:{}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"over-hidden"},[a("v-search-box",[a("div",[a("el-col",{attrs:{span:t.span}},[a("v-input",{attrs:{label:"关键词：",labelWidth:75,pxUnit:!0}},[a("el-input",{attrs:{placeholder:"请输入关键词",size:t.formSize},on:{blur:t.searchCheck},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:t.span}},[a("v-input",{attrs:{label:"日期：",labelWidth:70,pxUnit:!0}},[a("el-date-picker",{staticClass:"w-fill",attrs:{size:t.formSize,"value-format":"yyyy-MM-dd","picker-options":t.pickerOptions,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"btn"},slot:"btn"},[a("el-button",{attrs:{size:t.btnSize},on:{click:t.handlerSearch}},[t._v("查询")])],1)])],1)},staticRenderFns:[]};var l=a("VU/8")(o,s,!1,function(t){a("EMNk")},"data-v-7f7f18b1",null).exports,d=a("68+Y"),c={dataRoleList:"/dataRole/dataRoleList",listData:"/dataRole/list",updateStatusUser:"/user/updateStatus",updateData:"/dataRole/update",queryData:"/dataRole/queryById",orgTreeData:"/organization/queryOrganizationTree",insertData:"/dataRole/insert",deteleData:"/dataRole/delete"};function u(t){var e=c.listData;return Object(d.a)(e,{data:t,method:"post"})}function h(t){var e=c.queryData;return Object(d.a)(e,{params:t})}function p(t){var e=c.orgTreeData;return Object(d.a)(e,{params:t})}var f=a("IVM2"),m={dataRoleName:[{required:!0,trigger:"blur",validator:function(t,e,a){try{if("string"!=typeof e)return a(new Error("请输入数据角色名称"));if(!e.length)return a(new Error("请输入数据角色名称"));var r=f.a.textAlphaChinese.test(e),n=e.length<2||e.length>20;if(!r)return a(new Error("您输入不正确(须中、英文输入，2~20 位字符)重新输入"));if(n)return a(new Error("您输入不正确(须中、英文输入，2~20 位字符)重新输入"));a()}catch(t){a(new Error("输入异常,请联系管理员"))}}}],orgName:[{required:!0,message:"请选择所属组织",trigger:"change"}]},g={props:{tableData:{type:Array,default:function(){return[]}}},data:function(){return{radio:1,date:"",valueDate:"",span:8,type:"list",tableSize:i.a.tableSize,colWidth:i.a.colWidth,options:[{value:"0",label:"禁用"},{value:"1",label:"启用"}],queryParams:{name:"",beginDate:"",endDate:"",offset:1,limit:20},rules:m,total:0,pageSize:20,pageSizes:[20,40,60,100],currentPage:1}},computed:{},watch:{},created:function(){this.oldStatus=""},mounted:function(){this.getList()},methods:{getList:function(){var t=this;u(this.queryParams).then(function(e){t.total=e.data.total,t.currentPage=e.data.pageNum,t.pageSize=e.data.pageSize,t.dataRoleList=e.data.list}).catch(function(t){})},handlerChange:function(t,e){var a=this,r=t.status,n=t.id,i=(e.value,e.label,"1"===r?"是否需要对该用户账户进行启用":"是否需要对该用户账户进行禁用"),o="1"===r?"启用":"禁用";this._$confirm({content:i,title:o}).then(function(){var t,e;(t={status:r,id:n},e=c.updateStatusUser,Object(d.a)(e,{data:t,method:"post"})).then(function(t){a._send()})}).catch(function(){return a.getList(),!1})},updateBtn:function(t){this.$emit("edit",t)},deleteBtn:function(t){var e=this;this._$confirm({content:"此操作将永远删除,是否继续?"}).then(function(){var a,r;(a={id:t.id},r=c.deteleData,Object(d.a)(r,{params:a})).then(function(t){e._send()}).catch(function(t){})}).catch(function(){return!1})},detailBtn:function(t){this.$emit("detail",t)},_send:function(){this.$emit("update")}},filters:{formatStatus:function(t){return"0"===t?"禁用":"启用"},dateTimeDowith:function(t){return t.length>19?t.substr(0,19):t}},components:{}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{attrs:{size:t.tableSize,data:t.tableData,"highlight-current-row":"",stripe:!0,height:"100%",width:"100%",border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":t.colWidth,"show-overflow-tooltip":"",prop:"dataRoleName",label:"数据角色名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"edit-btn-class",attrs:{type:"text",size:"small"},on:{click:function(a){return t.detailBtn(e.row)}}},[t._v(t._s(e.row.dataRoleName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":t.colWidth,"show-overflow-tooltip":"",prop:"orgName",label:"所属组织"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":t.colWidth,"show-overflow-tooltip":"",prop:"createUser",label:"创建人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createDate","min-width":t.colWidth,"show-overflow-tooltip":"",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("dateTimeDowith")(e.row.createDate))+"\n                 ")]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"edit-btn-class",attrs:{type:"text",size:"small"},on:{click:function(a){return t.updateBtn(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{staticClass:"edit-btn-class",attrs:{type:"text",size:"small"},on:{click:function(a){return t.deleteBtn(e.row)}}},[t._v("删除")])]}}])})],1)],1)},staticRenderFns:[]};var b=a("VU/8")(g,v,!1,function(t){a("C49v")},"data-v-22daa47c",null).exports,w=a("//Fk"),_=a.n(w),S={data:function(){var t=this;return{selectRole:!1,radio:"1",btnSize:i.a.baseBtn,formSize:i.a.baseFormSize,addForm:{warrantOrgs:[],dataRoleName:"",id:-1,orgId:0,orgName:"",status:""},orgGroup:[],dataRoleGroup:[],isShowSelect:!1,orgName:"",dataRoleResult:[],roleResult:[],roleList:[],dataRoleList:[],orgData:[],treeShow:!1,defaultProps:{children:"childOrg",label:"name"},rules:n()({},m,{warrantOrgs:[{trigger:"change",validator:function(e,a,r){return t.getCheckedArr().length<=0?r(new Error("请选择数据角色权限")):r()},required:!0}]}),defaultOrgProps:{children:"childOrg",label:"name"},defaultDateProps:{children:"childOrg",label:"name"},orgTreeOption:[]}},props:{value:{type:Boolean,default:function(){return!1}},isEdit:{type:Boolean,default:function(){return!1}},id:{type:Number,default:function(){return""}}},created:function(){var t=this;this.status="",p({id:""}).then(function(e){t.orgGroup=[],t.dataRoleGroup=[],t.orgGroup=e.data.childOrg,t.dataRoleGroup.push(e.data)}),this.isEdit&&h({id:this.id}).then(function(e){t.type="update",t.addForm={dataRoleName:e.data.dataRoleName||"",orgId:e.data.orgId||"",orgName:e.data.orgName||"",id:e.data.id||0,warrantOrgs:e.data.warrantOrgs||[{}],status:e.data.status},t.getOrgTreeData().then(function(){t.$refs.tree.setCheckedNodes(e.data.warrantOrgs.filter(function(t){return"2"===t.mark}))}),t.orgTreeOption=e.data.warrantOrgs}).catch(function(e){var a=e;400!==a.statusCode&&"400"!==a.statusCode||t.$emit("input",!1)})},methods:{getOrgTreeData:function(){var t=this;return p({id:""}).then(function(e){return t.orgGroup=[],t.dataRoleGroup=[],t.orgGroup=e.data.childOrg,t.dataRoleGroup.push(e.data),_.a.resolve()}).catch(function(t){})},handlerSubmit:function(){var t=this;this.selectRole=!0,this.$refs.addForm.validate(function(e){return!!e&&(!(t.getCheckedArr().length<=0)&&(t.addForm.warrantOrgs=t.getCheckedArr(),void(t.isEdit?(t.addForm.id=t.id,(a=t.addForm,r=c.updateData,Object(d.a)(r,{data:a,method:"post"})).then(function(e){t.$emit("input",!1),t.$emit("update")})):function(t){var e=c.insertData;return Object(d.a)(e,{data:t,method:"post"})}(t.addForm).then(function(e){t.$emit("input",!1),t.$emit("update")}))));var a,r})},getCheckedArr:function(){var t=this.$refs.tree.getCheckedNodes();t.forEach(function(t){t.mark="2"});var e=this.$refs.tree.getHalfCheckedNodes();return e.forEach(function(t){t.mark="1"}),t.concat(e)},handlerCancel:function(){this.$emit("input",!1)},handleSelectOrg:function(){this.treeShow=!0},handleNodeClick:function(t){var e=t.id,a=t.name,r=t.code,n=t.parentId;this.treeShow=!1,this.orgName=a,this.addForm.pertainOrgs={id:e,name:a,code:r,parentId:n},this.selectRole=!0},updateOrgHandleClick:function(t){this.updateForm.orgName=t.name,this.treeShow=!1},updateRoleHandleClick:function(t){this.addForm.warrantOrgs=t.name,this.treeShow=!1},insertOrgHandleClick:function(t){this.addForm.orgName=t.name,this.addForm.orgId=t.id,this.treeShow=!1},insertRoleHandleClick:function(t){this.addForm.warrantOrgs=t.name,this.treeShow=!1}},watch:{dataRoleResult:function(t){var e=this;t.length>0?(this.addForm.pertainDataRoles=[],t.forEach(function(t){var a=e.dataRoleList.findIndex(function(e){return e.id===t});if(-1!==a){var r=e.dataRoleList[a],n=r.id,i=r.code,o=r.name;e.addForm.pertainDataRoles.push({id:n,name:o,code:i})}})):this.addForm.pertainDataRoles=""},roleResult:function(t){var e=this;t.length>0?(this.addForm.pertainRoles=[],t.forEach(function(t){var a=e.roleList.findIndex(function(e){return e.id===t});if(-1!==a){var r=e.roleList[a],n=r.id,i=r.code,o=r.name;e.addForm.pertainRoles.push({id:n,code:i,name:o})}})):this.addForm.pertainRoles=""}}},D={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"page p-t-40",on:{click:function(e){t.treeShow=!1}}},[a("el-col",{attrs:{span:10,offset:5}},[a("el-form",{ref:"addForm",attrs:{model:t.addForm,rules:t.rules,"label-width":"120px",size:t.formSize}},[a("el-form-item",{attrs:{label:"数据角色名称：",prop:"dataRoleName"}},[a("el-input",{attrs:{placeholder:"请输入数据角色名称"},model:{value:t.addForm.dataRoleName,callback:function(e){t.$set(t.addForm,"dataRoleName",e)},expression:"addForm.dataRoleName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"所属组织：",prop:"orgName"}},[a("el-input",{attrs:{placeholder:"请选择所属组织"},model:{value:t.addForm.orgName,callback:function(e){t.$set(t.addForm,"orgName",e)},expression:"addForm.orgName"}}),t._v(" "),a("div",{staticClass:"orgs-tree",on:{click:function(e){return e.stopPropagation(),t.handleSelectOrg(e)}}},[t.treeShow?a("v-input-box",{staticClass:"tree box-shadow"},[a("el-tree",{staticClass:"orgTree",attrs:{data:t.orgGroup,"empty-text":"暂无数据",props:t.defaultDateProps,accordion:"","highlight-current":"","node-key":"id","expand-on-click-node":!1},on:{"node-click":t.insertOrgHandleClick}})],1):t._e()],1)],1),t._v(" "),a("el-form-item",{staticStyle:{position:"relative"},attrs:{label:"数据角色权限：",prop:"warrantOrgs"}},[a("el-tree",{ref:"tree",staticClass:"dataTree",attrs:{"empty-text":"暂无数据","expand-on-click-node":!1,data:t.dataRoleGroup,props:t.defaultDateProps,"node-key":"id","show-checkbox":"","default-expand-all":""},on:{check:t.insertRoleHandleClick},model:{value:t.addForm.warrantOrgs,callback:function(e){t.$set(t.addForm,"warrantOrgs",e)},expression:"addForm.warrantOrgs"}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.addForm.warrantOrgs.length&&t.selectRole,expression:"!addForm.warrantOrgs.length&&selectRole"}],staticClass:"el-form-item__error"},[t._v("请选择数据角色授权")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{size:t.btnSize},on:{click:t.handlerCancel}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{size:t.btnSize,type:"primary"},on:{click:t.handlerSubmit}},[t._v("确 定")])],1)],1)],1)],1)])},staticRenderFns:[]};var R=a("VU/8")(S,D,!1,function(t){a("JbDN")},"data-v-74654e8a",null).exports,k={data:function(){return{radio:"1",span:8,bSing:!1,btnSize:i.a.baseBtn,detailData:{},defaultDateProps:{children:"childOrg",label:"name"},orgGroup:[],dataRoleGroup:[]}},props:{value:{type:Boolean,default:function(){return!1}},id:{type:Number,default:function(){return""}}},created:function(){var t=this;h({id:this.id}).then(function(e){e.data.createDate=t.dateTimeDowith(e.data.createDate)||"",t.type="detail",t.detailData={dataRoleName:e.data.dataRoleName||"",orgId:e.data.orgId||"",orgName:e.data.orgName||"",id:e.data.id||0,warrantOrgs:[e.data.authorityOrgs]||[],status:e.data.status,createUser:e.data.createUser||"",createDate:e.data.createDate||""},t.bSing=!0}).catch(function(t){})},methods:{getOrgTreeData:function(){var t=this;return p({id:""}).then(function(e){return t.orgGroup.push(e.data),t.dataRoleGroup.push(e.data),_.a.resolve()}).catch(function(t){})},handleBack:function(){this.$emit("input",!1)},formateArr:function(t){var e=[];return t.forEach(function(t){e.push(t.name)}),e.join("/")},formatStatus:function(t){return"0"===t?"禁用":"启用"},dateTimeDowith:function(t){return t.length>19?t.substr(0,19):t}},filters:{}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"page"},[t.bSing?a("el-col",{attrs:{span:12,offset:6}},[a("v-item-detail",{attrs:{tooltip:!0,label:"数据角色名称：",span:t.span}},[a("span",{staticClass:"block text-ellipsis"},[t._v(t._s(t.detailData.dataRoleName))]),t._v(" "),a("div",{staticClass:"tooltip-item",attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.detailData.dataRoleName))])]),t._v(" "),a("v-item-detail",{attrs:{tooltip:!0,label:"所属组织：",span:t.span}},[a("span",{staticClass:"block text-ellipsis"},[t._v(t._s(t.detailData.orgName))]),t._v(" "),a("div",{staticClass:"tooltip-item",attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.detailData.orgName))])]),t._v(" "),a("v-item-detail",{attrs:{tooltip:!1,label:"数据角色权限：",span:t.span}},[a("el-tree",{ref:"tree",staticClass:"dataTree",attrs:{"empty-text":"暂无数据",data:t.detailData.warrantOrgs,props:t.defaultDateProps,"node-key":"id","default-expand-all":""},model:{value:t.detailData.warrantOrgs,callback:function(e){t.$set(t.detailData,"warrantOrgs",e)},expression:"detailData.warrantOrgs"}})],1),t._v(" "),a("v-item-detail",{attrs:{tooltip:!0,label:"创建人：",span:t.span}},[a("span",{staticClass:"block text-ellipsis"},[t._v(t._s(t.detailData.createUser))]),t._v(" "),a("div",{staticClass:"tooltip-item",attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.detailData.createUser))])]),t._v(" "),a("v-item-detail",{attrs:{tooltip:!0,label:"创建时间：",span:t.span}},[a("span",{staticClass:"block text-ellipsis"},[t._v(t._s(t.detailData.createDate))]),t._v(" "),a("div",{staticClass:"tooltip-item",attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.detailData.createDate))])]),t._v(" "),a("div",{staticClass:"text-center m-t-32"},[a("el-button",{attrs:{size:t.btnSize},on:{click:t.handleBack}},[t._v("返回")])],1)],1):t._e()],1)])},staticRenderFns:[]};var C={props:{},data:function(){return{btnSize:i.a.homeBtn,tableData:[],total:0,addShow:!1,isEdit:!1,detailShow:!1,dataRoleId:"",queryParams:{name:"",keyword:"",beginDate:"",endDate:"",offset:1,limit:20},dataRoleList:[]}},computed:{},watch:{},created:function(){this._getData(!0)},methods:{_getData:function(){var t=this;try{u(this.queryParams).then(function(e){t.dataRoleList=[],t.total=e.data.total,t.currentPage=e.data.pageNum,t.pageSize=e.data.pageSize,t.dataRoleList=e.data.list||[]}).catch(function(t){})}catch(t){}},handlerAdd:function(){this.addShow=!0,this.isEdit=!1},handlerSearch:function(t){this.queryParams=n()({},this.queryParams,t),this.queryParams.offset=1,this._getData(),this.$refs.Fpage._init()},handlePagingChange:function(t){this.queryParams=n()({},this.queryParams,t),this._getData()},edit:function(t){this.isEdit=!0,this.addShow=!0,this.dataRoleId=t.id},viewDetail:function(t){var e=t.id;this.dataRoleId=e,this.detailShow=!0}},components:{UserSearch:l,DataRoleTable:b,Add:R,Detail:a("VU/8")(k,y,!1,function(t){a("MQPH")},"data-v-448bee46",null).exports}},O={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.addShow||t.detailShow?t._e():a("UserSearch",{on:{search:t.handlerSearch}}),t._v(" "),t.addShow||t.detailShow?t._e():a("div",{staticClass:"function-wrap"},[a("el-button",{attrs:{size:t.btnSize},on:{click:t.handlerAdd}},[t._v("新增")])],1),t._v(" "),t.addShow||t.detailShow?t._e():a("data-role-table",{staticClass:"user-table",attrs:{tableData:t.dataRoleList,total:t.total,stripe:!0},on:{update:function(e){return t._getData(!0)},detail:t.viewDetail,edit:t.edit}}),t._v(" "),t.addShow||t.detailShow?t._e():a("v-paging",{ref:"Fpage",attrs:{total:t.total},on:{pagingChange:t.handlePagingChange}}),t._v(" "),t.addShow?a("add",{attrs:{isEdit:t.isEdit,id:t.dataRoleId},on:{update:function(e){return t._getData(!0)}},model:{value:t.addShow,callback:function(e){t.addShow=e},expression:"addShow"}}):t._e(),t._v(" "),t.detailShow?a("detail",{attrs:{id:t.dataRoleId},model:{value:t.detailShow,callback:function(e){t.detailShow=e},expression:"detailShow"}}):t._e()],1)},staticRenderFns:[]};var N=a("VU/8")(C,O,!1,function(t){a("tIi/")},"data-v-1bdb42de",null);e.default=N.exports}});